from _moderngl import parse_spv_inputs, ATTRIBUTE_LOOKUP_TABLE

def test_spirv_parsing():
    raw = bytes.fromhex('''
        03022307000001000b000d00350000000000000011000200010000000b00060001000000474c534
        c2e7374642e343530000000000e00030000000000010000000f000b0000000000040000006d6169
        6e000000000d0000001200000021000000240000002c0000002f000000480005000b00000000000
        0000b00000000000000480005000b000000010000000b00000001000000480005000b0000000200
        00000b00000003000000480005000b000000030000000b00000004000000470003000b000000020
        0000047000400120000001e0000000000000047000400210000001e000000000000004700040024
        0000001e00000001000000470004002c0000001e00000001000000470004002f0000001e0000000
        2000000130002000200000021000300030000000200000016000300060000002000000017000400
        070000000600000004000000150004000800000020000000000000002b000400080000000900000
        0010000001c0004000a00000006000000090000001e0006000b00000007000000060000000a0000
        000a000000200004000c000000030000000b0000003b0004000c0000000d0000000300000015000
        4000e00000020000000010000002b0004000e0000000f0000000000000017000400100000000600
        000003000000200004001100000001000000100000003b0004001100000012000000010000002b0
        00400080000001300000000000000200004001400000001000000060000002b0004000800000019
        00000002000000200004001f00000003000000070000003b0004001f00000021000000030000001
        8000400220000000700000002000000200004002300000001000000220000003b00040023000000
        240000000100000020000400250000000100000007000000200004002b000000030000000600000
        03b0004002b0000002c000000030000003b0004002b0000002f0000000300000036000500020000
        00040000000000000003000000f8000200050000004100050014000000150000001200000013000
        0003d00040006000000160000001500000041000500140000001700000012000000090000003d00
        040006000000180000001700000041000500140000001a00000012000000190000003d000400060
        000001b0000001a00000050000700070000001e00000016000000180000001b0000001b00000041
        0005001f000000200000000d0000000f0000003e000300200000001e00000041000500250000002
        6000000240000000f0000003d0004000700000027000000260000003e0003002100000027000000
        3e0003002c0000001b0000008500050006000000340000001b0000001b0000003e0003002f00000
        034000000fd00010038000100'''.replace('\n        ', ''))

    result = {
        location: ATTRIBUTE_LOOKUP_TABLE[gltype]
        for location, gltype in parse_spv_inputs(raw).items()
    }

    must_be = [(0, ATTRIBUTE_LOOKUP_TABLE[0x8b51]), (1, ATTRIBUTE_LOOKUP_TABLE[0x8b66])]
    output = True
    for x in result.items():
        if x not in must_be:
            output = False
            break

    for x in must_be:
        if x not in result.items():
            output = False
            break

    assert output
